<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>¿Cómo usar Merge en n8n para tomar datos de nodos previos?</title>
  <style>
    :root {
      --primario-a: #551872;
      --primario-b: #F34E1E;
      --secundario-a: #484848;
      --secundario-b: #8BDCB3;
      --gris-sec: #5A5A5A;
      --fondo: #F8F8F8;
    }
    html,body {
      margin: 0;
      background: var(--fondo);
      color: var(--secundario-a);
      font-family: 'Inter', Arial, Helvetica, sans-serif;
      min-height: 100vh;
    }
    .teamcubation-logo {
      position: fixed;
      bottom: 18px;
      left: 28px;
      color: var(--primario-b);
      font-weight: 600;
      font-size: 20px;
      display: flex;
      align-items: center;
    }
    .teamcubation-logo:before {
      content: '';
      display: inline-block;
      width: 22px;
      height: 22px;
      background: url('https://teamcubation.com/wp-content/uploads/2022/10/cropped-Logo-Teamcubation.png') no-repeat center center/22px;
      margin-right: 7px;
    }
    header {
      text-align: center;
      padding: 2.5rem 1rem 1.5rem 1rem;
      background: var(--fondo);
    }
    h1 {
      font-size: 2rem;
      margin: 0 0 0.6em 0;
      color: var(--primario-a);
      font-weight: 700;
    }
    .sub {
      color: var(--primario-b);
      font-size: 1.12rem;
      margin-top: 0;
      font-weight: 500;
    }
    .container {
      max-width: 720px;
      margin: 0 auto 60px auto;
      padding: 2rem 1rem;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 4px 16px 0 #ececec44;
    }
    .steps {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }
    @media (max-width:600px) {
      .container { padding:1rem; }
      h1 { font-size:1.4rem;}
    }
    .step {
      display: flex;
      gap: 24px;
      align-items: flex-start;
    }
    @media (max-width:700px){
      .step { flex-direction: column; gap:10px; }
    }
    .step-index {
      min-width: 44px;
      min-height: 44px;
      border-radius: 50%;
      background: var(--primario-a);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.18rem;
      font-weight: bold;
    }
    .step-content { flex: 1; }
    .step-title {
      font-size: 1.15rem;
      color: var(--primario-b);
      margin: 0 0 4px 0;
      font-weight: bold;
    }
    .step-desc {
      color: var(--secundario-a);
      letter-spacing: 0.01em;
      font-size: 1rem;
      margin-bottom: 0.5em;
    }
    .simulador {
      background: var(--secundario-b);
      padding: 1.4rem 1rem;
      border-radius: 12px;
      margin: 18px 0 0 0;
      box-shadow: 0 2px 8px 0 #cccccc22;
      color: #222;
    }
    .simulador label{
      font-weight: 500;
      color: var(--primario-a);
      margin-right:8px;
    }
    .simulador select{
      font-size: 1rem;
      padding: 3px 8px;
      border-radius: 5px;
      border: 1px solid var(--gris-sec);
      margin-right:12px;
    }
    .diagram {
      margin-top: 14px;
      display: flex;
      overflow-x: auto;
      gap: 14px;
      align-items: flex-end;
    }
    .node {
      min-width: 80px;
      min-height: 60px;
      max-width: 110px;
      border-radius: 10px;
      background: var(--secundario-a);
      color: #fff;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
      font-weight: 500;
      position:relative;
      transition: background 0.2s, box-shadow 0.2s;
      box-shadow: 0 2px 8px 0 #cccccc33;
    }
    .node.active {
      background: var(--primario-b);
      box-shadow: 0 2px 12px 0 #f34e1e33;
      z-index: 1;
    }
    .node.merge {
      background: var(--primario-a);
    }
    .arrow {
      display: flex;
      align-items: flex-end;
      justify-content: center;
      height: 26px;
      min-width: 18px;
      color: var(--gris-sec);
      font-size: 1.3em;
      font-weight: bold;
    }
    .output-info {
      margin-top: 12px;
      background: #fff;
      padding:10px 14px;
      border-radius:8px;
      border: 1px solid #e9e9e9;
      font-size: 1rem;
      color: var(--primario-a);
      font-weight: 500;
    }
  </style>
</head>
<body>
  <header>
    <h1>Cómo usar <span style="color:var(--primario-b)">Merge</span> en n8n para tomar datos de un nodo anterior</h1>
    <div class="sub">Resolvamos juntos este problema clásico usando un ejemplo visual</div>
  </header>

  <div class="container">
    <div class="steps">
      <div class="step">
        <div class="step-index">1</div>
        <div class="step-content">
          <div class="step-title">El desafío</div>
          <div class="step-desc">En un flujo de n8n, a veces necesitas combinar información que viene de un nodo previo (por ejemplo, uno que está lejos en el flujo) con la de uno más reciente para continuar tu lógica.</div>
        </div>
      </div>
      <div class="step">
        <div class="step-index">2</div>
        <div class="step-content">
          <div class="step-title">Solución: Usar el nodo Merge</div>
          <div class="step-desc">El nodo <b>Merge</b> te permite reunir la información de dos caminos diferentes. Pero… ¿cómo elegir qué datos queda de cada entrada?</div>
        </div>
      </div>
      <div class="step">
        <div class="step-index">3</div>
        <div class="step-content">
          <div class="step-title">¡Probalo vos mismo!</div>
          <div class="step-desc">Usá la herramienta interactiva para ver cómo se combinan los datos cuando conectás diferentes nodos al Merge. <b>Seleccioná el nodo anterior y el inmediato para simularlo</b>.</div>
          <div class="simulador">
            <label for="prevNode">Nodo muy previo:</label>
            <select id="prevNode">
              <option value="N1">N1: Solicitar datos de usuario</option>
              <option value="N2">N2: Obtener órdenes</option>
              <option value="N3">N3: Transformar datos (intermedio)</option>
            </select>
            <label for="currNode">Nodo reciente:</label>
            <select id="currNode">
              <option value="N2">N2: Obtener órdenes</option>
              <option value="N3">N3: Transformar datos (intermedio)</option>
              <option value="N4" selected>N4: Validar dirección</option>
              <option value="N5">N5: Formatear respuesta</option>
            </select>
            <div class="diagram" id="diagram"></div>
            <div class="output-info" id="outputInfo"></div>
          </div>
        </div>
      </div>
      <div class="step">
        <div class="step-index">4</div>
        <div class="step-content">
          <div class="step-title">¿Por qué el orden importa?</div>
          <div class="step-desc">El Merge toma la información de ambas entradas. Dependiendo del método usado (por defecto: <b>Merge By Index</b>), el primer input suele tomar prioridad en los resultados combinados. Así podés tener a mano tanto los datos "viejos" como los nuevos.</div>
        </div>
      </div>
      <div class="step">
        <div class="step-index">5</div>
        <div class="step-content">
          <div class="step-title">Tips prácticos</div>
          <div class="step-desc">• Conectá siempre el nodo más "viejo" a la entrada 1 del Merge, y el más reciente a la entrada 2.<br>• Después del Merge, podés usar un "Set" o "Function" para tomar el dato exacto que necesitás.
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="teamcubation-logo">teamcubation_</div>

  <script>
    // Ejemplo de nodos y cómo combinan sus datos
    const nodos = {
      'N1': {label: 'Solicitar datos de usuario', datos: {nombre:"María", ciudad:"Rosario"}},
      'N2': {label: 'Obtener órdenes', datos: {orden: "#2578", monto: 320 }},
      'N3': {label: 'Transformar datos', datos: {fecha: "2024-06-15", validado: true}},
      'N4': {label: 'Validar dirección', datos: {direccion: "San Martín 1200"}},
      'N5': {label: 'Formatear respuesta', datos: {formato: "JSON"}},
    }

    function renderDiagram(nodoPrev, nodoCurr) {
      const diagrama = [nodoPrev, nodoCurr, 'MERGE'];
      const diagramDiv = document.getElementById('diagram');
      diagramDiv.innerHTML = '';
      // Render nodos y flechas
      diagrama.forEach((nid, idx) => {
        if (idx > 0) {
          const arrow = document.createElement('div');
          arrow.className = 'arrow';
          arrow.innerHTML = '&#8594;';
          diagramDiv.appendChild(arrow);
        }
        const isMerge = (nid=='MERGE');
        const div = document.createElement('div');
        div.className = 'node' + (isMerge ? ' merge': '') + (idx===2 ? ' active':'');
        div.innerHTML = isMerge ? '<div style="font-weight:bold;">MERGE</div><span style="font-size:.9em;">Combina</span>' 
          : `<span style="font-size:.9em;">${nid}</span><div>${nodos[nid].label}</div>`;
        diagramDiv.appendChild(div);
      });
    }

    function mergeData(nodoPrev, nodoCurr) {
      // Merge by Index: combina los objetos, priorizando los del nodo 2 en caso de conflicto
      return Object.assign({}, nodos[nodoPrev].datos, nodos[nodoCurr].datos);
    }

    function updateSimulador() {
      const nodoPrev = document.getElementById('prevNode').value;
      const nodoCurr = document.getElementById('currNode').value;

      renderDiagram(nodoPrev, nodoCurr);
      const output = mergeData(nodoPrev, nodoCurr);
      // Mostrar datos de salida
      const outputDiv = document.getElementById('outputInfo');
      outputDiv.innerHTML = `<b>Salida combinada del Merge:</b><br>`
        + `<pre style="font-size:.97em;white-space:pre-wrap;">${JSON.stringify(output, null, 2)}</pre>`;
    }
    document.getElementById('prevNode').addEventListener('change', updateSimulador);
    document.getElementById('currNode').addEventListener('change', updateSimulador);
    updateSimulador();
  </script>
</body>
</html>
