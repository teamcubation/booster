<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nodos de Control de Flujo en n8n - Explicación Interactiva</title>
    <style>
        /* --- Importación de Fuentes (Fallback) --- */
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');

        /* --- Variables de Marca (Teamcubation) --- */
        :root {
            --color-bg: #333333; /* Gris oscuro para mayor contraste */
            --color-surface: #484848;
            --color-primary: #551B72;   /* Púrpura */
            --color-secondary: #F34E1E; /* Naranja */
            --color-accent: #6BDCB3;    /* Menta */
            --color-text: #F0F0F0;
            --color-text-dark: #222222;
            --border-radius: 16px;
            --font-family: 'Helvetica Neue', 'Roboto', sans-serif;
        }

        /* --- Estilos Generales --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--color-bg);
            color: var(--color-text);
            line-height: 1.6;
            padding: 1rem;
        }

        /* --- Estructura y Contenedores --- */
        .container {
            max-width: 900px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: var(--color-surface);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        header {
            text-align: center;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--color-secondary);
            padding-bottom: 1rem;
        }
        
        header .logo {
            font-family: var(--font-family);
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--color-text);
            letter-spacing: 1px;
        }

        header .logo span {
            color: var(--color-secondary);
        }

        h1 {
            color: var(--color-primary);
            font-weight: 500;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--color-text);
        }
        
        h2 {
            font-size: 1.8rem;
            color: var(--color-primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #6a6a6a;
        }

        p {
            margin-bottom: 1rem;
            max-width: 70ch;
        }

        /* --- Navegación de Nodos --- */
        .node-nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 0.8rem 1.5rem;
            font-family: var(--font-family);
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            background-color: var(--color-secondary);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }

        .nav-btn:hover {
            transform: translateY(-3px);
            background-color: #d94215;
        }

        .nav-btn.active {
            background-color: var(--color-primary);
            box-shadow: 0 0 15px rgba(85, 27, 114, 0.7);
        }

        /* --- Paneles de Contenido --- */
        .node-panel {
            display: none;
            padding: 1.5rem;
            background-color: rgba(0,0,0,0.1);
            border-radius: var(--border-radius);
        }

        .node-panel.active {
            display: block;
        }

        .explanation {
            margin-bottom: 2rem;
        }
        
        .explanation .icon {
            font-size: 2rem;
            margin-right: 0.5rem;
        }

        /* --- Simulación Interactiva --- */
        .simulation-container {
            position: relative;
            padding: 2rem 1rem;
            border: 2px dashed #6a6a6a;
            border-radius: var(--border-radius);
            min-height: 450px;
            overflow: hidden;
        }
        
        .simulation-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
            gap: 1rem;
        }

        .btn-start-sim {
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--color-text-dark);
            background-color: var(--color-accent);
            border: none;
            border-radius: 30px;
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .btn-start-sim:hover {
            transform: scale(1.05);
        }
        
        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .toggle-switch input { display: none; }

        .toggle-switch label {
            cursor: pointer;
            background: #777;
            width: 50px;
            height: 26px;
            border-radius: 13px;
            position: relative;
            transition: background 0.3s;
        }
        .toggle-switch label::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            top: 3px;
            left: 3px;
            transition: transform 0.3s;
        }

        .toggle-switch input:checked + label {
            background: var(--color-accent);
        }
        .toggle-switch input:checked + label::after {
            transform: translateX(24px);
        }


        /* --- Elementos de la Simulación --- */
        .workflow-node {
            position: absolute;
            padding: 0.8rem 1.5rem;
            background-color: var(--color-primary);
            color: white;
            border-radius: 12px;
            text-align: center;
            font-weight: 500;
            z-index: 10;
        }
        
        .data-item {
            position: absolute;
            width: 100px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.8rem;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: all 1.5s ease-in-out;
            z-index: 5;
            background-color: #777;
            color: white;
        }
        
        .data-item.fruit { background-color: #e67e22; }
        .data-item.vegetable { background-color: #27ae60; }
        .data-item.approved { background-color: var(--color-accent); color: var(--color-text-dark); }
        .data-item.rejected { background-color: #c0392b; }
        .data-item.generic { background-color: #3498db; }

        .path-line {
            position: absolute;
            background-color: #6a6a6a;
            z-index: 1;
        }
        
        .path-label {
            position: absolute;
            color: #aaa;
            font-size: 0.9rem;
            z-index: 2;
        }

        /* --- Animaciones y Posiciones Específicas --- */
        
        /* Filter Sim */
        #filter-sim .start { top: 20px; left: 50%; transform: translateX(-50%); }
        #filter-sim .node-filter { top: 150px; left: 50%; transform: translateX(-50%); }
        #filter-sim .end { top: 350px; left: 50%; transform: translateX(-50%); }

        /* If Sim */
        #if-sim .start { top: 20px; left: 50%; transform: translateX(-50%); }
        #if-sim .node-if { top: 150px; left: 50%; transform: translateX(-50%); }
        #if-sim .end-true { top: 350px; left: 25%; transform: translateX(-50%); }
        #if-sim .end-false { top: 350px; left: 75%; transform: translateX(-50%); }
        #if-sim .path-label-true { top: 250px; left: 25%; transform: translateX(-50%); color: var(--color-accent); }
        #if-sim .path-label-false { top: 250px; left: 75%; transform: translateX(-50%); color: #c0392b; }

        /* Loop Sim */
        #loop-sim .start { top: 20px; left: 50%; transform: translateX(-50%); }
        #loop-sim .node-loop { top: 150px; left: 50%; transform: translateX(-50%); }
        #loop-sim .node-process { top: 300px; left: 50%; transform: translateX(-50%); }

        /* Merge Sim */
        #merge-sim .start-a { top: 20px; left: 25%; transform: translateX(-50%); }
        #merge-sim .start-b { top: 20px; left: 75%; transform: translateX(-50%); }
        #merge-sim .node-merge { top: 200px; left: 50%; transform: translateX(-50%); }
        #merge-sim .end { top: 380px; left: 50%; transform: translateX(-50%); }


        /* --- Responsividad --- */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
                margin: 1rem auto;
            }
            h1 { font-size: 2rem; }
            .node-nav { gap: 0.5rem; }
            .nav-btn { padding: 0.6rem 1rem; font-size: 0.9rem;}
            .data-item { width: 80px; height: 35px; font-size: 0.7rem; }
            .workflow-node { padding: 0.6rem 1rem; font-size: 0.9rem; }
            
            /* Ajuste para simulación en móviles */
            #if-sim .end-true, #merge-sim .start-a { left: 20%; }
            #if-sim .end-false, #merge-sim .start-b { left: 80%; }
            #if-sim .path-label-true { left: 20%; }
            #if-sim .path-label-false { left: 80%; }
        }

    </style>
</head>
<body>

    <div class="container">
        <header>
            <div class="logo">teamcubation<span>_</span></div>
            <h1>Nodos de Control de Flujo en n8n</h1>
            <p>Descubrí de forma interactiva cómo funcionan los nodos que dirigen tus datos.</p>
        </header>

        <nav class="node-nav">
            <button class="nav-btn active" data-target="filter">Filter (Filtrar)</button>
            <button class="nav-btn" data-target="if">If (Si...)</button>
            <button class="nav-btn" data-target="loop">Loop (Bucle)</button>
            <button class="nav-btn" data-target="merge">Merge (Unir)</button>
        </nav>

        <main>
            <!-- Panel Filter -->
            <section id="panel-filter" class="node-panel active">
                <h2><span class="icon">🔍</span>Filter: El Colador de Datos</h2>
                <div class="explanation">
                    <p>Imagina que tienes una canasta con frutas y verduras, pero solo quieres cocinar con las <strong>frutas</strong>. El nodo <strong>Filter</strong> actúa como un colador: revisa cada elemento y solo deja pasar aquellos que cumplen con la condición que le diste.</p>
                </div>
                <div class="simulation-controls">
                    <button class="btn-start-sim" id="start-filter-sim">Iniciar Simulación</button>
                </div>
                <div id="filter-sim" class="simulation-container">
                    <!-- Nodos Estáticos -->
                    <div class="workflow-node start">Entrada de Datos</div>
                    <div class="workflow-node node-filter">Filter: "es fruta?"</div>
                    <div class="workflow-node end">Salida</div>
                    <!-- Líneas de Flujo -->
                    <div class="path-line" style="top: 60px; left: 50%; width: 2px; height: 90px; transform: translateX(-50%);"></div>
                    <div class="path-line" style="top: 205px; left: 50%; width: 2px; height: 145px; transform: translateX(-50%);"></div>
                </div>
            </section>

            <!-- Panel If -->
            <section id="panel-if" class="node-panel">
                <h2><span class="icon">↔️</span>If: La Bifurcación del Camino</h2>
                <div class="explanation">
                    <p>El nodo <strong>If</strong> es como una bifurcación. Revisa una condición y, dependiendo de si es <strong>verdadera o falsa</strong>, envía los datos por un camino u otro. Es perfecto para tomar decisiones, como enviar un email de bienvenida si el usuario es nuevo, o uno de "gracias por volver" si ya existía.</p>
                </div>
                 <div class="simulation-controls">
                    <div class="toggle-switch">
                        <span>Rechazado</span>
                        <input type="checkbox" id="if-condition-toggle" checked>
                        <label for="if-condition-toggle"></label>
                        <span>Aprobado</span>
                    </div>
                    <button class="btn-start-sim" id="start-if-sim">Iniciar Simulación</button>
                </div>
                <div id="if-sim" class="simulation-container">
                    <!-- Nodos Estáticos -->
                    <div class="workflow-node start">Llega un Pedido</div>
                    <div class="workflow-node node-if">If: "está aprobado?"</div>
                    <div class="workflow-node end-true" style="background-color: var(--color-accent); color: var(--color-text-dark);">Enviar Confirmación</div>
                    <div class="workflow-node end-false" style="background-color: #c0392b;">Notificar Rechazo</div>
                    <!-- Líneas y etiquetas -->
                    <div class="path-line" style="top: 60px; left: 50%; width: 2px; height: 90px; transform: translateX(-50%);"></div>
                    <div class="path-line" style="top: 205px; left: 50%; width: 2px; height: 70px; transform: translateX(-50%);"></div>
                    <div class="path-line" style="top: 275px; left: 37.5%; width: 25%; height: 2px;"></div>
                    <div class="path-line" style="top: 275px; left: 25%; width: 2px; height: 75px; transform: translateX(-50%);"></div>
                    <div class="path-line" style="top: 275px; left: 75%; width: 2px; height: 75px; transform: translateX(-50%);"></div>
                    <div class="path-label path-label-true">✔️ Verdadero</div>
                    <div class="path-label path-label-false">❌ Falso</div>
                </div>
            </section>

            <!-- Panel Loop -->
            <section id="panel-loop" class="node-panel">
                <h2><span class="icon">🔄</span>Loop: Repetir una Tarea</h2>
                <div class="explanation">
                    <p>El nodo <strong>Loop</strong> (o "Split in Batches" que es como funciona en n8n) es para hacer la misma acción varias veces. Si tienes una lista de 5 emails para enviar, este nodo tomará la lista, la dividirá, y procesará cada email <strong>uno por uno</strong>, pasándolo por la misma secuencia de acciones.</p>
                </div>
                <div class="simulation-controls">
                    <button class="btn-start-sim" id="start-loop-sim">Iniciar Simulación</button>
                </div>
                <div id="loop-sim" class="simulation-container">
                    <div class="workflow-node start">Lista de Tareas</div>
                    <div class="workflow-node node-loop">Loop Over Items</div>
                    <div class="workflow-node node-process" style="background-color: var(--color-secondary);">Procesar Tarea</div>
                    <!-- Líneas -->
                    <div class="path-line" style="top: 60px; left: 50%; width: 2px; height: 90px; transform: translateX(-50%);"></div>
                     <div class="path-line" style="top: 205px; left: 50%; width: 2px; height: 95px; transform: translateX(-50%);"></div>
                </div>
            </section>

            <!-- Panel Merge -->
            <section id="panel-merge" class="node-panel">
                 <h2><span class="icon">➕</span>Merge: Unir los Caminos</h2>
                <div class="explanation">
                    <p>El nodo <strong>Merge</strong> hace lo contrario a un "If". Si tenías los datos separados en diferentes ramas (por ejemplo, después de una decisión), este nodo los <strong>vuelve a juntar en un solo flujo</strong>. Es útil para que todos los datos, sin importar por qué camino fueron, terminen en el mismo lugar (ej: una base de datos final).</p>
                </div>
                <div class="simulation-controls">
                    <button class="btn-start-sim" id="start-merge-sim">Iniciar Simulación</button>
                </div>
                <div id="merge-sim" class="simulation-container">
                    <div class="workflow-node start-a">Datos de API</div>
                    <div class="workflow-node start-b">Datos de Formulario</div>
                    <div class="workflow-node node-merge">Merge</div>
                    <div class="workflow-node end" style="background-color: var(--color-accent); color: var(--color-text-dark);">Guardar en Base de Datos</div>
                    <!-- Líneas -->
                     <div class="path-line" style="top: 60px; left: 25%; width: 2px; height: 140px; transform: translateX(-50%);"></div>
                     <div class="path-line" style="top: 60px; left: 75%; width: 2px; height: 140px; transform: translateX(-50%);"></div>
                     <div class="path-line" style="top: 200px; left: 25%; width: 25%; height: 2px;"></div>
                     <div class="path-line" style="top: 200px; left: 50%; width: 25%; height: 2px;"></div>
                     <div class="path-line" style="top: 255px; left: 50%; width: 2px; height: 125px; transform: translateX(-50%);"></div>
                </div>
            </section>
        </main>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const navButtons = document.querySelectorAll('.nav-btn');
        const panels = document.querySelectorAll('.node-panel');

        // --- Navegación Principal ---
        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                const targetId = `panel-${button.dataset.target}`;

                // Botones
                navButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                // Paneles
                panels.forEach(panel => {
                    if (panel.id === targetId) {
                        panel.classList.add('active');
                    } else {
                        panel.classList.remove('active');
                    }
                });
            });
        });

        // --- Lógica de Simulación ---
        const createDataItem = (id, text, type, container, top, left) => {
            const item = document.createElement('div');
            item.id = id;
            item.className = `data-item ${type}`;
            item.textContent = text;
            item.style.top = `${top}px`;
            item.style.left = `calc(${left} - 50px)`; // Centrar el item
            container.appendChild(item);
            return item;
        };

        const resetSimulation = (containerId) => {
            const container = document.getElementById(containerId);
            container.querySelectorAll('.data-item').forEach(item => item.remove());
        };

        // --- Simulación FILTER ---
        document.getElementById('start-filter-sim').addEventListener('click', function() {
            const container = document.getElementById('filter-sim');
            resetSimulation('filter-sim');

            const itemsData = [
                { id: 'f1', text: 'Manzana', type: 'fruit' },
                { id: 'f2', text: 'Banana', type: 'fruit' },
                { id: 'v1', text: 'Zanahoria', type: 'vegetable' },
            ];
            
            itemsData.forEach((data, index) => {
                const item = createDataItem(data.id, data.text, data.type, container, 50 + index * 10, '50%');
                
                setTimeout(() => {
                    item.style.top = '155px'; // Mover al nodo Filter
                    
                    setTimeout(() => {
                        if (data.type === 'fruit') {
                            item.style.top = '355px'; // Pasa el filtro
                        } else {
                            item.style.opacity = '0'; // No pasa el filtro
                            item.style.transform = 'scale(0.5)';
                        }
                    }, 1500);
                }, 100 + index * 200);
            });
        });
        
        // --- Simulación IF ---
        document.getElementById('start-if-sim').addEventListener('click', function() {
            const container = document.getElementById('if-sim');
            resetSimulation('if-sim');
            
            const isApproved = document.getElementById('if-condition-toggle').checked;
            const itemData = isApproved 
                ? { id: 'd1', text: 'Pedido #123', type: 'approved' }
                : { id: 'd1', text: 'Pedido #123', type: 'rejected' };

            const item = createDataItem(itemData.id, itemData.text, itemData.type, container, 50, '50%');
            
            setTimeout(() => {
                item.style.top = '155px'; // Mover al nodo If
                
                setTimeout(() => {
                    if (isApproved) {
                        item.style.top = '355px';
                        item.style.left = 'calc(25% - 50px)'; // Camino Verdadero
                    } else {
                        item.style.top = '355px';
                        item.style.left = 'calc(75% - 50px)'; // Camino Falso
                    }
                }, 1500);
            }, 100);
        });

        // --- Simulación LOOP ---
        document.getElementById('start-loop-sim').addEventListener('click', function() {
            const container = document.getElementById('loop-sim');
            resetSimulation('loop-sim');

            const itemsData = [
                { id: 'l1', text: 'Tarea A', type: 'generic' },
                { id: 'l2', text: 'Tarea B', type: 'generic' },
                { id: 'l3', text: 'Tarea C', type: 'generic' },
            ];

            const batch = document.createElement('div');
            batch.style.position = 'absolute';
            batch.style.transition = 'top 1.5s ease-in-out';
            batch.style.top = '50px';
            batch.style.left = '50%';
            batch.style.transform = 'translateX(-50%)';
            container.appendChild(batch);
            
            const items = itemsData.map((data, index) => {
                 const item = createDataItem(data.id, data.text, data.type, batch, index * 10, '50%');
                 item.style.position = 'relative';
                 item.style.left = 'auto';
                 item.style.marginBottom = '5px';
                 item.style.opacity = '1';
                 return item;
            });
            
            setTimeout(() => {
                 batch.style.top = '155px'; // Mover al nodo Loop
                 
                 setTimeout(() => {
                    items.forEach((item, index) => {
                        // Mover cada item individualmente
                        item.style.transition = `all ${1 + index * 0.5}s ease-in-out`;
                        container.appendChild(item); // Sacar del batch
                        item.style.top = '155px';
                        item.style.left = `calc(50% - 50px)`;
                        
                        setTimeout(() => {
                            item.style.top = '305px';
                            item.style.opacity = '0.5';
                             setTimeout(() => { item.style.opacity = '0'; }, 1000);
                        }, 500 * (index + 1));
                    });
                    batch.remove();
                 }, 1500);

            }, 100);
        });
        
        // --- Simulación MERGE ---
        document.getElementById('start-merge-sim').addEventListener('click', function() {
            const container = document.getElementById('merge-sim');
            resetSimulation('merge-sim');

            const itemA = createDataItem('m1', 'Dato API', 'fruit', container, 50, '25%');
            const itemB = createDataItem('m2', 'Dato Form', 'vegetable', container, 50, '75%');

            setTimeout(() => {
                // Mover ambos al nodo Merge
                itemA.style.top = '205px';
                itemA.style.left = 'calc(50% - 50px)';
                
                itemB.style.top = '205px';
                itemB.style.left = 'calc(50% - 50px)';
                
                setTimeout(() => {
                    // Mover ambos a la salida
                     itemA.style.top = '385px';
                     itemB.style.top = '385px';
                     itemB.style.left = 'calc(50% - 40px)'; // Pequeño offset para ver ambos
                }, 1500);

            }, 100);
        });

    });
    </script>
</body>
</html>